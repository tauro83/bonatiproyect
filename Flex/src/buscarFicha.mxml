<!--@Author Camilo Verdugo
	@Version	2
-->
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" initialize="getAllFichas()" layout="absolute" borderColor="#15AD8F" width="779" height="466" title="Visualizar Ficha" >
	<mx:Script>		
		<![CDATA[
			//=======================================================================
			// FECHA: CREACIÓN: 5 Octubre
			// AUTOR: Camilo Verdugo
			// Muestra los datos de todas las fichas del sistema
			//=======================================================================
			import transferObjects.Mascota;
			import mx.controls.List;
			import mx.events.ListEvent; 			
			import mx.controls.Alert;
			import mx.collections.ArrayCollection;
            import mx.controls.CheckBox;    
            import mx.events.CloseEvent;
            import mx.rpc.events.ResultEvent;
            import services.ListarFichasService;
            import mx.core.Application;	
			[Bindable]
			private var listFichas:ListarFichasService;
			private var verFicha:VisualizarFicha;
			[Bindable]		
			private var mascotas:ArrayCollection;
			
						
			/**
		 	 * 	@author  "Camilo Verdugo"
			 * 	@Fecha  5 Octubre
			 *  @Descripcion Metodo que es llamdo al iniciar el componente. Se encarga de solicitar 
			 *  al as las mascotas que estan registradas en el sistema, de tal forma que permita su seleccion posterior
			 * */
			public function getAllFichas():void
			{				
				listFichas = new ListarFichasService();
				listFichas.getMascotas();	
				listFichas.addEventListener(ResultEvent.RESULT,getAllMascotasR);
							
			}
			
			
			/**
		 	 * 	@author  "Camilo Verdugo"
			 * 	@Fecha  5 Octubre
			 *  @Descripcion El resultado del metodo anterior y del retorno de as es recibido por este metodo
			 *  El cual asigna la lista de mascotas obtenidas.
			 * */                   
            public function getAllMascotasR(event:ResultEvent):void
            {
				mascotas = event.result as ArrayCollection;	
            }
           
            /**
		 	 * 	@author  "Camilo Verdugo"
			 * 	@Fecha  5 Octubre
			 *  @Descripcion Metodo que es llamado por la accion del boton visualizar y mediante la selccion directa
			 *  se encarga de hacer el llamado al otro panel de tal forma que se muestren los datos de la mascota nueva
			 * */ 
            public function viewFicha(event:Event):void
            {
            	if(fichas.selectedItem){
            		this.setVisible(false,false);            	 	
            		verFicha.setDatos(fichas.selectedItem as Mascota);
            		verFicha.setVisible(true,false);
            	}
            
            }
          	
          	 /**
		 	 * 	@author  "Camilo Verdugo"
			 * 	@Fecha  5 Octubre
			 *  @Descripcion Metodo que es llamado desde Veterinaria.mxml el cual obtiene el componente en el cual
			 *  Se cargan los datos de la ficha
			 * */ 
            public function setVisualizarFicha(verFicha:VisualizarFicha):void
            {
            	this.verFicha = verFicha;               	
            }
            
            /**
		 	 * 	@author  "Camilo Verdugo"
			 * 	@Fecha  5 Octubre
			 *  @Descripcion Metodo que retorna al panel anterior
			 * */
            private function cancelarBuscar():void
            {
            	Application.application.setInvisible();
            	Application.application.panel2.setVisible(true,false);
            	Application.application.AdmOpciones1.setVisible(true,false);
            }
            
		]]> 
  	</mx:Script>	
	
	<mx:DataGrid x="52" y="38" width="662" height="305" id="fichas" dataProvider="{mascotas}" itemClick="viewFicha(event)">
		<mx:columns>			
			<mx:DataGridColumn headerText="Nombre mascota" 	dataField="nombre"/>
			<mx:DataGridColumn headerText="Rut cliente"   		dataField="rutCliente"/>
			<mx:DataGridColumn headerText="Raza" visible="true"   dataField="raza"/>
			<mx:DataGridColumn headerText="Raza" visible="false"    dataField="sexo"/>
			<mx:DataGridColumn headerText="Raza" visible="false"   dataField="fechaNacimiento"/>
		</mx:columns>
	</mx:DataGrid>
	<mx:Button x="502" y="357" label="Visualizar" id="botonVerficha"  click="viewFicha(event)" width="102"/>
	<mx:Button x="612" y="357" label="Volver"  toolTip="Cancela la operación" width="102" click="cancelarBuscar()"/>
	<mx:Label x="52" y="12" text="Seleccione la mascota:" fontWeight="bold"/>
	<mx:Label x="158" y="394" width="407" height="17" id="labelMessage" textAlign="center"/>
</mx:Panel>
