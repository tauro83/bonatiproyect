<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="779" height="466" title="Agenda" xmlns:ns1="*" initialize="iniciarAgenda()" borderColor="#15AD8F">
	<mx:Script>
		<![CDATA[
			import transferObjects.Cliente;
		
			//=======================================================================
			// FECHA CREACIÓN: 05/10/2009
			// AUTOR: Sebastian Arancibia
			// …. Clase que contiene los atributos del objeto DiaAgenda
			//=======================================================================
			
			/**
			 * Componente de Agenda
			 * @autor Sebastian Arancibia
			 */
			import mx.events.ListEvent;
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.ListEvent;
			import mx.core.Application;
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import transferObjects.Usuario;
			import mx.rpc.events.ResultEvent;
			import administracion.UsuarioEditService;
			import flash.events.MouseEvent;
            import mx.events.FlexEvent;
            import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			import mx.controls.Alert;
			import services.configuracionServices;	
			
			import services.citaServices;
			import transferObjects.Cita;
			
			import util.reportPrint;
			import mx.managers.PopUpManager;
            import mx.containers.TitleWindow;
			
			import services.BitacoraCitaService;
			import transferObjects.BitacoraCita;
			
			//raullrich
			import transferObjects.Cita;
			import administracion.EditarCitaService;
			import administracion.EditCitaUpdate;
			private var cita:Cita;
			private var citaEditada:Cita;
			//eliminado CITA
			import transferObjects.Cita;
			import administracion.DeleteCitaService;
			import administracion.GetAllMascotas;
			//raullrich
			
			
			[Bindable]
			private var usuarios:ArrayCollection;
			private var usuars:ArrayCollection;
			private var usuars2:ArrayCollection;
			private var datosUsuarios:ArrayCollection;
			
			[Bindable]
			private var citas:ArrayCollection;
			public var cliente:Cliente;
			
			
			import flash.events.MouseEvent;
            import mx.events.FlexEvent;
            import mx.rpc.events.ResultEvent;
			import mx.rpc.events.FaultEvent;
			import services.DiaAgendaServices;
			import administracion.UsuarioEditService;
			import transferObjects.Usuario;
			
			import util.Properties;
			
			[Bindable]
			public var diasBloqueados:ArrayCollection = new ArrayCollection();
			
			[Bindable]
            public var diaAgenda:ArrayCollection = new ArrayCollection(
                [{hora:"10:30"}, {hora:"11:00"}, {hora:"11:30"}, {hora:"12:00"}, {hora:"12:30"}, 
                 {hora:"15:30"}, {hora:"16:00"}, {hora:"16:30"}, {hora:"17:00"}, {hora:"17:30"}, 
                 {hora:"18:00"}, {hora:"18:30"}, {hora:"19:00"}, {hora:"19:30"}, {hora:"20:00"}]); 
                 
            [Bindable]
            public var semanaAgenda:ArrayCollection = new ArrayCollection(
                [{hora:"10:30"}, {hora:"11:00"}, {hora:"11:30"}, {hora:"12:00"}, {hora:"12:30"}, 
                 {hora:"15:30"}, {hora:"16:00"}, {hora:"16:30"}, {hora:"17:00"}, {hora:"17:30"}, 
                 {hora:"18:00"}, {hora:"18:30"}, {hora:"19:00"}, {hora:"19:30"}, {hora:"20:00"}]); 
             
            [Bindable]
            public var servicios:ArrayCollection = new ArrayCollection(); 
                 
                 
            private var ct:citaServices = new citaServices();
			private var c1:Cita;
			
			
			
             /**
			 * Funcion para asignar agenda dependiendo de la fecha seleccionada
			 * @param even evento para asignar agenda
			 */   
            private function asignarAgenda(event:Event):void{
            	servicioOutput.text = servicioInput.text;
            	if(servicioInput.text != "Todos"){
            		labelMessage.text = "";
            	}
            	cambioFecha();
            }
           /**
			 * Funcion que bloquea dia
			 */ 
            private function bloquearDia():void{
            	diasBloqueados.addItem(fechaOutput.text);
            	this.agendaDia.selectedItem = null;
            	cambioFecha();
            	
            }
            /**
			 * Funcion que cambia de fecha
			 * 
			 */ 
            private function cambioFecha():void{
            	var date:Date;
            	if(calendario.selectedDate != null){
            		date = calendario.selectedDate;
            	}else{
            		date = new Date();
            	}

            	fechaOutput.text = (date.getDate()) + "/" + (date.getMonth()+1) + "/" + date.getFullYear();
            	
            	if(diasBloqueados.contains(fechaOutput.text)){
            		fechaBloqueadoOutput.text = "(Bloqueado)";
            		agendaDia.selectable = false;
            	}
            	else{
            		agendaDia.selectable = true;
            		fechaBloqueadoOutput.text = "";		
            		
            		getDiaAgenda();
        
            	}
            
            }
           /**
			 * Funcion que bloquea un dia
			 * 
			 */ 
            private function desbloquearDia():void{
            	var index:int = diasBloqueados.getItemIndex(fechaOutput.text);
            	diasBloqueados.removeItemAt(index);
            	cambioFecha();
            }
            /**
			 * Funcion que retorna todas las citas de una fecha
			 * 
			 */ 
            public function getDiaAgenda():void{
				var diaAgenda:DiaAgendaServices = new DiaAgendaServices();
				diaAgenda.addEventListener(ResultEvent.RESULT,getDiaAgendaResult);
				diaAgenda.getDiaAgenda(fechaOutput.text);
			}
			/**
			 * Funcion que captura las citas de una fecha
			 * 
			 */ 
			private function getDiaAgendaResult(event:ResultEvent):void{
				citas = event.result as ArrayCollection;
            	llenarAgendaDia(citas);   
			}
			
			private function bloquearHora():void
			{								 
					
					/*c1					= new Cita();
					c1.cliente 			= "00";
					c1.mascota      	= "No Disponible";
					
					if(calendario.selectedDate != null){
						c1.fecha        	= calendario.selectedDate.getDate() + "/" + (calendario.selectedDate.getMonth()+1) + "/" +calendario.selectedDate.getFullYear();
					}
					else{
						var newDate:Date = new Date();
						c1.fecha        	= newDate.getDate() + "/" + (newDate.getMonth()+1) + "/" +newDate.getFullYear();
					}
					c1.hora			    = agendaDia.selectedItem.hora;
					c1.servicio			= "No Disponible";
	        				
					c1.usuario	= usuarioInput.selectedItem.usuario;
					
					ct.addCita(c1);				
					ct.addEventListener(ResultEvent.RESULT,registroCitaResultado);
					*/
					
					var c:Cita = new Cita();
					c.cliente = "000000000";
					c.mascota = "No Disponible";
					c.servicio = "No Disponible";
					
					c.hora = agendaDia.selectedItem.hora;
					c.usuario = usuarioInput.selectedItem.usuario;
					
					//Alert.show("1");
					if(calendario.selectedDate != null) 
						c.fecha = calendario.selectedDate.getDate() + "/" + (calendario.selectedDate.getMonth()+1) + "/" +calendario.selectedDate.getFullYear();
					else{
						var newDate:Date = new Date();
						c.fecha = newDate.getDate() + "/" + (newDate.getMonth()+1) + "/" +newDate.getFullYear();
					}
					
					var diaAgenda:DiaAgendaServices = new DiaAgendaServices();
					diaAgenda.addEventListener(ResultEvent.RESULT,bloquearResult);
					diaAgenda.bloquear(c);
																									
				}
			private function bloquearResult(event:ResultEvent):void
			{
				var message:String= event.result as String;	
				var msj:String = "";
				if(message=="1"){
					labelMessage.text = "Hora bloqueada"; 	
					iniciarAgenda();
    		 	}
				else{
					labelMessage.text = "La hora no pudo ser bloqueada"; 				
				}
			}		
			
			/**
		 	 * 	@author  "Victor Silva"
			 * 	@Fecha  03 Octubre
			 *  @Descripcion retorna el resultado de la accion que se realizo:Registro.		
			 * */
			private function registroCitaResultado(event:ResultEvent):void
			{
				var message:String= event.result as String;	
				var msj:String = "";
				if(message=="1"){
					labelMessage.text = "Hora bloqueada"; 	
					iniciarAgenda();
    		 	}
				else{
					labelMessage.text = "La hora no pudo ser bloqueada"; 				
				}		
			}		
			
			
			
			/**
			 * Funcion que llena la tabla con las citas
			 * 
			 */ 
			public function llenarItemDia(citass:ArrayCollection, hora:String):void{
				var copado:Boolean;
				var i:int;
				
				copado = false;
				for(i=0; i < citass.length; i++){
                	if(citass.getItemAt(i).hora == hora){
                		var b:Boolean = false;
                		var j:int;
                	
                		if(servicioInput.text == "Todos"){
	                		if(usuarioInput.text == "Todos"){
	                			var item:Object = citass.getItemAt(i);
	        					var k:int;
	        					for(k=0; k< datosUsuarios.length; k++){
	        						if(datosUsuarios.getItemAt(k).usuario == item.responsable){
	        							item.responsable = datosUsuarios.getItemAt(k).nombre + " " + datosUsuarios.getItemAt(k).apellido;
	        							item.usuario = datosUsuarios.getItemAt(k).usuario;
	        						}
	        					}
	        					
		    				    diaAgenda.addItem(item);
		        				copado = true;
	                		}
	                		else{
		                		for(j=0; j < datosUsuarios.length; j++){
		                			if(datosUsuarios.getItemAt(j).usuario == citass.getItemAt(i).responsable && 
		                				datosUsuarios.getItemAt(j).nombre + " " + datosUsuarios.getItemAt(j).apellido == usuarioInput.text){
		                				
		                				item = citass.getItemAt(i);
				        				for(k=0; k< datosUsuarios.length; k++){
				        					if(datosUsuarios.getItemAt(k).usuario == item.responsable){
	        									item.responsable = datosUsuarios.getItemAt(k).nombre + " " + datosUsuarios.getItemAt(k).apellido;
	        									item.usuario = datosUsuarios.getItemAt(k).usuario;
	        								}
	        							}
		                				diaAgenda.addItem(item);
		                				copado = true;
		                			   }
		                		}
	                		}
                		}
                		else{
                			if(usuarioInput.text == "Todos" && citass.getItemAt(i).servicio == servicioInput.text){
	                			item = citass.getItemAt(i);
	
	        					for(k=0; k< datosUsuarios.length; k++){
	        						if(datosUsuarios.getItemAt(k).usuario == item.responsable){
	        							item.responsable = datosUsuarios.getItemAt(k).nombre + " " + datosUsuarios.getItemAt(k).apellido;
	        							item.usuario = datosUsuarios.getItemAt(k).usuario;
	        						}
	        					}
		    				    diaAgenda.addItem(item);
		    				    //Aqui deberia colorear
		        				copado = true;
	                		}
	                		else{
		                		for(j=0; j < datosUsuarios.length; j++){
		                			if(datosUsuarios.getItemAt(j).usuario == citass.getItemAt(i).responsable && 
		                				datosUsuarios.getItemAt(j).nombre + " " + datosUsuarios.getItemAt(j).apellido == usuarioInput.text &&
		                				citass.getItemAt(i).servicio == servicioInput.text){
		                				
		                				item = citass.getItemAt(i);
				        				for(k=0; k< datosUsuarios.length; k++){
				        					if(datosUsuarios.getItemAt(k).usuario == item.responsable){
	        									item.responsable = datosUsuarios.getItemAt(k).nombre + " " + datosUsuarios.getItemAt(k).apellido;
	        									item.usuario = datosUsuarios.getItemAt(k).usuario;
	        								}
	        							}
		                				diaAgenda.addItem(item);
		                				copado = true;
		                			   }
		                		}
	                		}
                		}
                	}
                }
				if(!copado){
					diaAgenda.addItem({hora:hora});
				}
			}
			/**
			 * Funcion que llena la tabla de citas
			 * 
			 */ 
			public function llenarAgendaDia(citass:ArrayCollection):void{
				diaAgenda = new ArrayCollection();

                llenarItemDia(citass, "10:30");
                llenarItemDia(citass, "11:00");
                llenarItemDia(citass, "11:30");
                llenarItemDia(citass, "12:00");
                llenarItemDia(citass, "12:30");
                llenarItemDia(citass, "15:30");
                llenarItemDia(citass, "16:00");
                llenarItemDia(citass, "16:30");
                llenarItemDia(citass, "17:00");
                llenarItemDia(citass, "17:30");
                llenarItemDia(citass, "18:00");
                llenarItemDia(citass, "18:30");
                llenarItemDia(citass, "19:00");
                llenarItemDia(citass, "19:30");
                llenarItemDia(citass, "20:00");
                
                agendaDia.dataProvider = diaAgenda;
			} 
            /**
			 * Funcion que retorna todos los usuarios del sistema
			 * 
			 */ 
            public function getAllUsuarios():void{
				var personService:UsuarioEditService = new UsuarioEditService();
				personService.addEventListener(ResultEvent.RESULT,getAllUsuariosEResult);
				personService.getAllUsuariosE();	
			}
			/**
			 * Funcion que captura todos los usuarios del sistema
			 * 
			 */ 
			private function getAllUsuariosEResult(event:ResultEvent):void{
				usuarios = event.result as ArrayCollection;
				var responsables:ArrayCollection;
				responsables = new ArrayCollection();
				datosUsuarios = new ArrayCollection();
				
				var i:int;
				responsables.addItem({label:"Todos"});
				for(i=0; i < usuarios.length; i++){
            		var nombre:String = usuarios.getItemAt(i).nombre.split(" ",1);
            		//Alert.show(nombre);
            		var apellido:String = usuarios.getItemAt(i).apellidoPaterno.split(" ",1);
            		datosUsuarios.addItem({usuario:usuarios.getItemAt(i).usuario.split(" ",1), nombre:nombre, apellido:apellido});
            		responsables.addItem({label:(nombre + " " + apellido), usuario:usuarios.getItemAt(i).usuario.split(" ",1)});
            	}
            	usuarioInput.dataProvider = responsables;
			}  
			
			public function iniciales():String{
			   var usuarillo:Array  = new Array();
			   var usuarillo2:Array  = new Array();
			   var usuarillo3:Array  = new Array();
			   var nombreUsu:String;
			   var apaternoUsu:String;
			   var aux:String
			   var i:int;
			   for(i = 0; i<usuarios.length ; i++){
						
					usuarillo = usuarios[i].nombre.split(" ",1);
					nombreUsu  = usuarillo.pop();
						
					usuarillo2 = usuarios[i].apellidoPaterno.split(" ",1);
					apaternoUsu= usuarillo2.pop();
					if(agendaDia.selectedItem.responsable == nombreUsu + " " + apaternoUsu){
						usuarillo3 = usuarios[i].usuario.split(" ",1);
						aux = usuarillo3.pop();
						//clienteAuxEditado.usuario = aux;
						
						
					}
				}
				return aux;
			
			}
            /**
			 * Funcion que inicia la agenda
			 * 
			 */ 
            public function iniciarAgenda():void{
            	var fechaActual:Date = new Date();
            	
            	regControl.visible = false;
            	editar.visible = false;
            	agendar.visible = false;
            	eliminar.visible = false;
            	bloq.visible = false;
            	
            	//calendario.selectedDate = new Date();
            	getAllUsuarios();
			
            	cargarServicios();
            	servicioOutput.text = "Todos";
            	fechaOutput.text = fechaActual.getDate() + "/" + (fechaActual.getMonth()+1) + "/" +fechaActual.getFullYear();
            	
            	servicioInput.text = "Todos";
            	usuarioInput.text = "Todos";
            	
            	getDiaAgenda();
            } 
            
            /** 
			 *  Obtiene los servicios desde el actionScript
		 	 * 	@author  "Camilo Verdugo"
			 * */
			public function cargarServicios():void
			{
				var confs:configuracionServices= new configuracionServices();
				confs.getConfiguraciones("Servicio");
				confs.addEventListener(ResultEvent.RESULT,cargarServiciosResult);
			}
			
			/** 
			 *  Asigna el retorno del llamado de cargarDatos a un
			 *   arrayCollection para mostrar las configuraciones
		 	 * 	@author  "Camilo Verdugo"
			 * */
			public function cargarServiciosResult(event:ResultEvent):void
			{
				servicios = event.result as ArrayCollection;
				servicios.addItemAt({nombre:"Todos"},0);
				servicioInput.selectedIndex = 0;
				
			}
               
            /**
			 * Funcion que inicia el calendario
			 * 
			 */  
			public function iniciarCalendario():void{
				calendario.dayNames = ["D", "L", "M", "M", "J", "V", "S", "D"];
				calendario.monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio",
										 "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
				calendario.disabledDays = [0];
			}
			/**
			 * Funcion que selecciona una cita
			 * 
			 */ 
			[Bindable]
			public var newCita:Cita;
			
			
			
			public function seleccionarCita(event:Event):void
			{
				if((servicioInput.text == "Todos" || usuarioInput.text == "Todos") && agendaDia.selectedItem.mascota == null){
					labelMessage.text = Properties.getMensaje("Advertencia", "13");
				}
				else{  
					
					if(Application.application.agenda2.agendaDia.selectedItem.cliente != null)
			    {
					//tomo los datos del datagrid y los copia a un objeto cita
					var newCitaUpdate:EditCitaUpdate = Application.application.editarCita;
					newCita = new Cita();					
					newCita.hora = agendaDia.selectedItem.hora;
					newCita.mascota = agendaDia.selectedItem.mascota;
					newCita.cliente = agendaDia.selectedItem.cliente;
					newCita.fecha   = agendaDia.selectedItem.fecha;
					newCita.servicio= agendaDia.selectedItem.servicio;
					newCita.usuario = agendaDia.selectedItem.usuario;
					
					newCitaUpdate.responsable2.text = agendaDia.selectedItem.responsable;
					
					
				    Application.application.agenda2.setVisible(false,false);
				    
					newCitaUpdate.carga(newCita);			
					newCitaUpdate.cargarMascotas();	    				    
				    Application.application.editarCita.setVisible(true,false);
				   
				    
			 	}
			 	else{
			    	Application.application.agenda2.setVisible(false);
			     	Application.application.registrarCita.setVisible(true);
			     	Application.application.registrarCita.fecha.data = calendario.selectedDate;
			     	Application.application.registrarCita.hora.text = agendaDia.selectedItem.hora; 
			   	 	Application.application.registrarCita.servicio.text = servicioInput.selectedLabel;
			   	 	Application.application.registrarCita.iniciarPanel();
			    	
			    	if(calendario.selectedDate != null)
			    		Application.application.registrarCita.fecha.selectedDate = calendario.selectedDate;
			    	else
			    		Application.application.registrarCita.fecha.selectedDate = new Date();
			    		
			    	Application.application.registrarCita.usuarioNombre.text = usuarioInput.selectedLabel;
			     	Application.application.registrarCita.usuario.text = usuarios[usuarioInput.selectedIndex-1].usuario;			    }
			 	

			}
			}
			/**
			 * Funcion que consulta una accion realizada por el usuario
			 * dependiendo de cual sea se ocultaran o mostraran algunas opciones
			 */ 
			public function consultarAccion(event:Event):void{
				var selectedRow:Object = event.currentTarget.selectedItem;
				
				if(selectedRow.mascota != null && selectedRow.servicio == "Policlínico"){
					regControl.visible = true;
				}
				else{
					regControl.visible = false;
				}
				
				if(selectedRow.mascota == null && (servicioInput.text != "Todos" || usuarioInput.text != "Todos")){
					agendar.visible = true;
					eliminar.visible = false;
					editar.visible = false;
					
					bloq.visible = true;
					
				}
				else{
					if(selectedRow.mascota != null){
						labelMessage.text = "";
						agendar.visible = false;
						bloq.visible = false;
						eliminar.visible = true;
						editar.visible = true;
					}
					else{
						labelMessage.text = Properties.getMensaje("Advertencia", "13");
						agendar.visible = false;
						bloq.visible = false;
						eliminar.visible = false;
						editar.visible = false;
					}
				}	
			}
			////////////////////////////////////INICIO ELIMINAR CITA///////////////////////
			///////////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////
			private var cita2:Cita;
			
			private function deleteCita(event:Event):void{
   				if(agendaDia.selectedItem!=null){
   					
   					cita2 = new Cita();

					cita2.cliente = agendaDia.selectedItem.cliente;	
			 		cita2.hora = agendaDia.selectedItem.hora;
			 		cita2.mascota = agendaDia.selectedItem.mascota;
			 		cita2.servicio = agendaDia.selectedItem.servicio;
			 		cita2.fecha = agendaDia.selectedItem.fecha;
			 		cita2.usuario = agendaDia.selectedItem.responsable;
	
   					//Alert.show(cita2.cliente+"|"+cita2.hora+"|"+cita2.mascota+"|"+cita2.servicio);
   					var respon:String = iniciales();
   					//Alert.show("¿Está seguro que desea eliminar los datos seleccionados? ","Confirme eliminación ", Alert.YES | Alert.NO);
   					var citaService:DeleteCitaService=new DeleteCitaService();
					citaService.addEventListener(ResultEvent.RESULT,deleteCitaResult);
					citaService.purgarCita(agendaDia.selectedItem.fecha, agendaDia.selectedItem.hora, agendaDia.selectedItem.servicio, respon);
   				}
   				else{
   					labelMessage.text = Properties.getMensaje("Advertencia", "14");
   				}
   				 
   			}
   			
   			private function deleteCitaResult(event:ResultEvent):void{
				var result:int = event.result as int ;
				if(result < 1)
				{
				   //linea editada
				   iniciarAgenda();
				   labelMessage.text = Properties.getMensaje("Informacion", "12");
				   //getAllMascotas();
				   
				   //Alert.show(cita2.cliente+"|"+cita2.hora+"|"+cita2.mascota+"|"+cita2.servicio);
				   var bc:BitacoraCita = new BitacoraCita();
					
					bc.cliente = cita2.cliente;
					bc.fechaCita = cita2.fecha;		
			 		bc.horaCita = cita2.hora;
			 		bc.mascota = cita2.mascota;
			 		bc.servicio = cita2.servicio;
			 		bc.usuario = Application.application.login2.usuarioActivo;
			 		bc.accion = "Eliminar";
			 		
			 		//Alert.show(bc.cliente+"|"+bc.fechaCita+"|"+bc.horaCita+"|"+bc.mascota+"|"+bc.servicio+"|"+bc.usuario+"|"+bc.accion);
			   	  	
			   	  	var bcs:BitacoraCitaService = new BitacoraCitaService;
    		 		bcs.addBitacoraCita(bc);
	   
				   
				}
				else
				   labelMessage.text = Properties.getMensaje("Error", "9");
			}
			
			private function imprime():void
           	{
           			
           			var re:reportPrint = reportPrint(PopUpManager.createPopUp( this, reportPrint , true));
           			citas.addItem({servicio: "-"});
           			re.cargarDat(citas);

	        }
	        private function registrarControl():void{
	        	Application.application.setInvisible();
            	Application.application.registroControl.setVisible(true, false);
                Application.application.opcionesClinica1.setVisible(true,false);
	        	
	        	//Application.application.registroControl.iniciarPanel();
	        	Application.application.registroControl.currentState = "NuevoControl";
	        	//Application.application.registroControl.getAllUsuarios();
	        	
	        	//Application.application.registroControl.buscadorCliente.rutClienteInput.text = "12";
	        	
	        	//Alert.show(agendaDia.selectedItem.cliente);
	        	var largo:int = agendaDia.selectedItem.cliente.length;
	        	Application.application.registroControl.buscadorCliente.rutClienteInput.text = agendaDia.selectedItem.cliente.substring(0,largo-1);
				Application.application.registroControl.buscadorCliente.rutClienteDVInput.text = agendaDia.selectedItem.cliente.charAt(largo-1);
			
				
				Application.application.registroControl.buscadorCliente.llenarApellido();
				
				Application.application.registroControl.buscadorCliente.rutClienteInput.editable = false;
				Application.application.registroControl.buscadorCliente.rutClienteDVInput.editable = false;
				
				Application.application.registroControl.nombreMascota.text = agendaDia.selectedItem.mascota;
				//Alert.show(agendaDia.selectedItem.usuario);
				Application.application.registroControl.definirResponsable(agendaDia.selectedItem.usuario);
				
				
				
				
				
	        	
	        	//Alert.show(agendaDia.selectedItem.servicio);
	        }


			////////////////////////////////////TERMINA ELIMINAR CITA///////////////////////
			///////////////////////////////////////////////////////////////////////////////
			////////////////////////////////////////////////////////////////////////////////
 		]]>
 	</mx:Script>		
	<mx:DateChooser id="calendario" x="10" y="35" width="182" height="153" yearNavigationEnabled="true"
		initialize=" iniciarCalendario()" change="cambioFecha()"/>
        <mx:LinkBar color="0x0050AA" horizontalAlign="right" width="98" dataProvider="{tiposCalendario}" x="651" y="10"/>
        <mx:ViewStack id="tiposCalendario" width="550" height="268" x="200" y="35">
            <mx:VBox id="dia" label="Día" width="100%" height="100%">
                <mx:Canvas width="550" height="266">
                    <mx:DataGrid id="agendaDia" x="0" y="0" width="550" height="266" dataProvider="{semanaAgenda}" doubleClickEnabled="true" itemDoubleClick="{seleccionarCita(event)}" itemClick="{consultarAccion(event)}">
                        <mx:columns>
                            <mx:DataGridColumn headerText="Hora" dataField="hora"  fontWeight="bold" width="45"/>
                            <mx:DataGridColumn headerText="Cliente" dataField="cliente" visible="false"/>
                            <mx:DataGridColumn headerText="Cliente" width="150" dataField="nombreCliente"/>
                            <mx:DataGridColumn headerText="Mascota" dataField="mascota"/>
                            <mx:DataGridColumn headerText="Servicio" dataField="servicio"/>
                            <mx:DataGridColumn headerText="Responsable" dataField="responsable"/>
                            <mx:DataGridColumn headerText="Usuario" dataField="usuario" visible="false"/>
                        </mx:columns>
                    </mx:DataGrid>
                </mx:Canvas>
            </mx:VBox>
            <!--
            <mx:VBox id="semana" label="Semana" width="100%" height="100%">
                <mx:Canvas width="550" height="266">
                    <mx:DataGrid id="agendaSemana" x="0" y="0" width="550" height="266"  textAlign="center" dataProvider="{diaAgenda}" selectable="false">
                        <mx:columns>
                        	<mx:DataGridColumn headerText="Hora" dataField="hora" textAlign="left" width="45" fontWeight="bold"/>
                            <mx:DataGridColumn headerText="Lunes" dataField="1"/>
                            <mx:DataGridColumn headerText="Martes" dataField="2"/>
                            <mx:DataGridColumn headerText="Miercoles" dataField="3"/>
                            <mx:DataGridColumn headerText="Jueves" dataField="4"/>
                            <mx:DataGridColumn headerText="Viernes" dataField="5"/>
                            <mx:DataGridColumn headerText="Sabado" dataField="6"/>
                        </mx:columns>
                    </mx:DataGrid>
                </mx:Canvas>
            </mx:VBox>
            -->
        </mx:ViewStack>
        <mx:Label x="10" y="198" text="Responsable:"/>
        <mx:ComboBox id="usuarioInput" x="10" y="224" width="182" close="{asignarAgenda(event)};">
		</mx:ComboBox>
        <mx:Label x="10" y="254" text="Servicio:"/>
        <mx:ComboBox id="servicioInput" x="10" y="280" width="182" close="{asignarAgenda(event)};" dataProvider="{servicios}" labelField="nombre">
		</mx:ComboBox>
        <mx:Button id="agendar" x="564" y="312" label="Agendar" visible="false" click="{seleccionarCita(event)}" toolTip="Debe seleccionar Servicio y Responsable para Agendar"/>
        <mx:Button id="eliminar" x="564" y="312" label="Eliminar" visible="false" click="{deleteCita(event)}" width="75"/>
        <mx:Button id="bloquear" x="200" y="311" label="Bloquear Día" click="bloquearDia()" visible="false"/>
        <mx:Button id="desbloquear" x="200" y="312" label="Desbloquear Día" click="desbloquearDia()" visible="false"/>
        <mx:Text x="200" y="10" text="Fecha:" fontWeight="bold" visible="false"/>
        <mx:Label id="fechaOutput" x="248" y="10" visible="false"/>
        <mx:Label id="fechaBloqueadoOutput" x="200" y="14" visible="true"/>
        <mx:Text x="437" y="10" text="Servicio:" fontWeight="bold" visible="false"/>
        <mx:Label id="servicioOutput" x="491" y="10" visible="false"/>
        <mx:Label x="176" y="399" width="407" height="17" id="labelMessage" textAlign="center" fontWeight="bold"/>
        <mx:Button x="481" y="312" label="Editar" id="editar" visible="false" click="{seleccionarCita(event)}" width="75"/>
        <mx:Button x="647" y="311" label="Imprimir" width="102" height="23" id="impriButtonPr" click="{imprime()}"/>
        <mx:Button x="479" y="312" label="Bloquear" id="bloq" visible="false" click="bloquearHora()"/>
        <mx:Button x="355" y="312" label="Registar Control" visible="false" id="regControl" click="registrarControl()"/>
</mx:Panel>
