<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" initialize="cargarDatos()" width="779" height="466" title="Configuración Mascota" borderColor="#15AD8F">
	<mx:Script>
		<![CDATA[
			import mx.messaging.channels.StreamingAMFChannel;
			import mx.events.IndexChangedEvent;
			//=======================================================================
			// FECHA: CREACIÓN: 27 Octubre
			// AUTOR: Camilo Verdugo
			// Modulo de mantencion de especies y razas del sistema
			//=======================================================================
			import mx.core.Application;
			import mx.collections.ArrayCollection;   
			import mx.rpc.events.ResultEvent;
			import services.configuracionServices;
			import transferObjects.Configuracion;
			import mx.controls.Alert;
			[Bindable]private var especies:ArrayCollection;
			private var confs:configuracionServices= new configuracionServices();
		
		
			/** obtiene las especies desde el actionScript
		 	 * 	@author  "Camilo Verdugo"
			 * */
			public function cargarDatos():void
			{				
				confs.getConfiguraciones("Especie");
				confs.addEventListener(ResultEvent.RESULT,cargarDatosR);
			}
			/** reinicia las variables y borra las entradas de textos y mensajes de
			 *  sistema
		 	 * 	@author  "Camilo Verdugo"
			 * */
			public function resetVars():void
			{
				especieInput.text = "";
				ltexto.text = "";
			}
			/** asigna el retorno del llamado de cargarDatos a un
			 *   arrayCollection para mostrar las configuraciones
		 	 * 	@author  "Camilo Verdugo"
			 * */
			public function cargarDatosR(event:ResultEvent):void
			{
				especies = event.result as ArrayCollection;	
			}
			
			/** metodo que retorna al panel de administacion, este es llamado
			 *  por el botton "Volver"
		 	 * 	@author  "Camilo Verdugo"
			 * */
			public function cancelarVisulizar():void
			{	
				Application.application.setInvisible();
            	Application.application.panel2.setVisible(true,false);
            	Application.application.AdmOpciones1.setVisible(true,false);
            	this.resetVars();
			}
			
			/** obtiene la configuracion seleccionada del grid
		 	 * 	@author  "Camilo Verdugo"
			 * */
			public function setNombre(event:Event):void
			{
				if(especiesGrid.selectedItem){
            		especieInput.text = especiesGrid.selectedItem.nombre; 
            		agregar.enabled = false;   
            		eliminar.enabled = true;  
            		ltexto.text = "";
            	}		
            			
			}
		
			/** envia una configuracion y muestra un mensaje de confirmacion de la accion.
		 	 * 	@author  "Camilo Verdugo"
			 * */
			private function registrarNombre(event:Event):void
			{
				var nombre:String = especieInput.text;
				nombre = nombre.replace(" ","");
				if(nombre.length>0 && existeNombre(nombre)==false){
					confs.regConfiguracion("Especie", especieInput.text);
					this.cargarDatos();
					ltexto.text = "Especie registrada exitosamente";
				}else{
					ltexto.text = "Ingrese una especie antes de registrar";
				}
				especieInput.text = "";				
			}
			
			private function existeNombre(nombre2:String):Boolean
			{	
				var i:int = 0;		
				while(i<especies.length){
					var s:String = especies.getItemAt(i).nombre;
					s = s.replace(" ","");
					if(s == nombre2){						
						return true;
					}
					i++;
				}
				return false;
			}
			
			/** elimina la configuracion seleccionada del data grid
		 	 * 	@author  "Camilo Verdugo"
			 * */
			private function eliminarNombre(event:Event):void
			{
				confs.elimConfiguracion("Especie", especieInput.text);
				this.cargarDatos();
				ltexto.text = "Especie eliminada exitosamente";
				especieInput.text = "";
			}
			/** habilita el boton de registrar posterior a su deshabilitacion por la accion de eliminar
		 	 * 	@author  "Camilo Verdugo"
			 * */
			private function activarRegistrar(event:Event):void
			{
				agregar.enabled = true;
				eliminar.enabled = false; 		
				ltexto.text = "";		
			}
		]]>
	</mx:Script>
		
	
	<mx:DataGrid x="25" y="127.25" width="311.15" id="especiesGrid" itemClick="setNombre(event)" dataProvider="{especies}" height="200">
		<mx:columns>
			<mx:DataGridColumn headerText="Nombre" dataField="nombre"/>
		</mx:columns>
	</mx:DataGrid>
	<mx:Label x="25" y="10" text="Especies " width="152" fontWeight="bold"/>
	<mx:Button xmlns:mx="http://www.adobe.com/2006/mxml" width="102" height="23" x="234.15" click="eliminarNombre(event)" label="Eliminar" y="81" icon="@Embed(source='../images/Arriba.png')" id="eliminar"/>
	<mx:Button xmlns:mx="http://www.adobe.com/2006/mxml" width="102" height="23" x="25"  click="registrarNombre(event)" label="Registrar" y="81" icon="@Embed(source='../images/Abajo.png')" id="agregar"/>
	<mx:TextInput x="25" y="36" width="311.15" restrict="A-Z a-z ñ Ñ Á É Í Ó Ú á é í ó ú"  id="especieInput" click="activarRegistrar(event)"/>
	<mx:Button xmlns:mx="http://www.adobe.com/2006/mxml" width="102" height="23" x="632" label="Volver" y="353" click="cancelarVisulizar()"/>
	<mx:Label x="176" y="399" width="407" height="17" id="ltexto" fontWeight="bold" textAlign="center"/>
		
</mx:Panel>
