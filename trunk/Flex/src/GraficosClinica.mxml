//=======================================================================
// FECHA CREACIÓN: 28-09-09
// AUTOR: Andres Garrido
// Componente que tiene un grafico  y muestra las estadisticas de clinica
//=======================================================================


<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="779" height="383" horizontalAlign="center">
	<mx:Script>
		<![CDATA[
		import mx.rpc.events.ResultEvent;
		
		//XML List for loaded XML file. Must be bindable!
		[Bindable]private var testInfo:XMLList;
		
		private function xmlHandler(evt:ResultEvent):void{
			//Sets testInfo's root as the atenciones. Everything else referenced in respect to this.
			testInfo = evt.result.atencion;
		}
		
		private function changeData(dataSet:String):void{
			//Determina que se set debe ser cargado
			switch (dataSet){
				case ('set1'):
					//Set URL target to pabellon
					testData.url ="assets/pabellon.xml";
					break;
				case ('set2'):
					//Set URL target to policlinico
					testData.url ="assets/policlinico.xml";
					break;
				default:
					break;
			}
			//Envia el URL Request para actualizar el grafico
			testData.send();
		}
		
		]]>
	</mx:Script>
	<!--Efectos para cuando un dato del grafico cambia-->
	<mx:SeriesInterpolate id="changeEffect" duration="2000"/>
	
	<!--Carga el archivo url y XML y luego lo envia a la funcion xmlHandler en formato E4X-->
	<mx:HTTPService url="assets/pabellon.xml" id="testData" result="xmlHandler(event)" resultFormat="e4x"/>
	
	<mx:Panel horizontalAlign="center" title="Estadísticas para Clínica" height="382" width="776">
		
		<!--The Chart -->
		<mx:ColumnChart dataProvider="{testInfo}" id="chartEstadisticaClinica" showDataTips="true" height="254" width="540">
			<mx:horizontalAxis>
				<mx:CategoryAxis dataProvider="{testInfo}" categoryField="name"/>
			</mx:horizontalAxis>
			<mx:series>
				<mx:ColumnSeries showDataEffect="{changeEffect}" xField="name" yField="sat" displayName="Frecuencia de uso"/>
			</mx:series>
		</mx:ColumnChart>
		
		<!--Display Controls-->
		<mx:HBox height="30" horizontalAlign="center">
			<mx:Button  label="Pabellón" click="changeData('set1')" toolTip="Presione para obtener estadísticas de pabellón"/>
			<mx:Button label="Policlínico" click="changeData('set2')" toolTip="Presione para obtener estadísticas de policlínico"/>
		</mx:HBox>
		
		<!--Legend for Chart Data-->
		<mx:Legend dataProvider="{chartEstadisticaClinica}" width="145"/>
		
	</mx:Panel>
</mx:VBox>
