<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="779" height="466" borderColor="#15AD8F" title="Registrar Cirugía">
	<mx:Script>
        <![CDATA[
        	import transferObjects.tiposCir;
        	import services.AddMascotaService;
        	import mx.controls.DateField;
        	import mx.controls.Alert;
            import mx.collections.ArrayCollection;
        	import mx.controls.Alert;
			import mx.events.CloseEvent;
			import mx.events.ValidationResultEvent;            
  			import flash.display.Sprite;
		    import flash.events.*;
		    import flash.net.FileReference;
		    import flash.net.FileReferenceList;
		    import mx.rpc.events.ResultEvent;

			import mx.controls.Image;
		    import transferObjects.Cirugia;
		    import mx.core.Application;
		    
		   
			[Bindable]
			public var clienteRut:String;
			[Bindable]
			public var clienteRut2:String;
			[Bindable]
			public var nombreMascota:String;
			[Bindable]
			public var hora:String;
			[Bindable]
			public var veterinarios2:ArrayCollection;
			[Bindable]
			public var ayudantes2:ArrayCollection;
			[Bindable]
			public var ayudantes3:ArrayCollection;
			[Bindable]
			public var tiposCir1:ArrayCollection;
			[Bindable]
			public var tiposCir2:ArrayCollection;
			[Bindable]
			public var cirugsAdds:ArrayCollection;
		   
		    
		    public function vuelve():void
		    {
		    	this.setVisible(false,false);
		    	Application.application.addCirug.labelMessage.text="";
		    	Application.application.addCirug.iniciarPanel1();
		    	Application.application.addCirug.setVisible(true,false);
		    }
		    
		    public function registrarCiru():void{
		    	
		    	if(this.veterinariosC.text==""){
		    		this.labelMessage.text="Seleccione el nombre de un Veterinario para la cirugía.";
		    	}
		    	else{
		    		if(this.ayudantesC.text==""){
		    			this.labelMessage.text="Seleccione el nombre de un ayudante para la cirugía.";
		    		}
		    		else{
		    			if(this.costoC.text==""){
		    				this.labelMessage.text="Ingrese un costo para la cirugía.";
		    			}
		    			else{
		    				if(this.fechaC.text==""){
		    					this.labelMessage.text="Seleccione una fecha para la cirugía.";
		    				}
		    				else{
		    					if(this.diagC.text==""){
		    						this.labelMessage.text="Ingrese un diagnostico para la cirugía.";
		    					}
		    					else{
		    						if(this.cirugsAdds.length==0){
		    							this.labelMessage.text="Añada un tipo de cirugía que se haya realizado a la mascota.";
		    						}
		    						else{
		    							this.labelMessage.text="";
		    							var newCirugia:Cirugia = new Cirugia();
		    	
		    							newCirugia.ayudante = this.ayudantesC.text;
		    							newCirugia.veterinario= this.veterinariosC.text;
		    							newCirugia.costo = this.costoC.text;
		    							newCirugia.fecha = this.fechaC.text;
		    							newCirugia.diagnostico = this.diagC.text;
		    							newCirugia.tiposCirugias = this.cirugsAdds;
		    							newCirugia.clienteRut = this.clienteRut;
		    							newCirugia.clienteRut2 = this.clienteRut2;
		    							newCirugia.mascotaNombre = this.nombreMascota;
		    							
		    							var newAddServ:AddCirugiaService = new AddCirugiaService();
		    							newAddServ.addCirugia(newCirugia);
		    							this.setVisible(false,false);
		    							Application.application.addCirug.iniciarPanel1();
		    							Application.application.addCirug.labelMessage.text="Cirugía Registrada con exito.";
		    							Application.application.addCirug.setVisible(true,false);
		    						}
		    					}
		    				}
		    			}
		    		}
		    	}
		    	
		    	
		    }
		    
		     public function quitaCir():void
		    {
		    	
		    	if(tabCirs.selectedItem){
		    		var s:String = tabCirs.selectedItem.cirugias;
		    		var tc:tiposCir = new tiposCir();
					renombrarCir2(s);
		    	}
		    	else{
		    		this.labelMessage.text="Seleccione una cirugía de la tabla Cirugías a realizar.";
		    	}
		    	
				
		    }
		    
		    public function renombrarCir2(texto:String):void{
		    	var newAr:ArrayCollection = this.cirugsAdds;
		    	cirugsAdds = new ArrayCollection();
		    	var i:int;
		    	var j:int = newAr.length;
		    	for(i=0;i<j;i++){
		    		var s:String = newAr.removeItemAt(0).cirugias;
		    		if(s!=texto){
		    			var tc:tiposCir = new tiposCir();
		    			tc.cirugias=s;
		    			cirugsAdds.addItem(tc);
		    		}
		    	}
		    	
		    }
		    
		    public function guardaCir():void
		    {
		    	
		    	if(cirugias1.selectedItem){
		    		var s:String = cirugias1.selectedItem.cirugias;
		    		var tc:tiposCir = new tiposCir();
		    		tc.cirugias=s;
		    		cirugsAdds.addItem(tc);
					renombrarCir(s);
		    	}
		    	else{
		    		this.labelMessage.text="Seleccione una cirugía de la tabla Cirugías.";
		    	}
		    	
				
		    }
		    
		    public function renombrarCir(texto:String):void{
		    	var newAr:ArrayCollection = this.tiposCir1;
		    	tiposCir1 = new ArrayCollection();
		    	var i:int;
		    	var j:int = newAr.length;
		    	for(i=0;i<j;i++){
		    		var s:String = newAr.removeItemAt(0).cirugias;
		    		if(s!=texto){
		    			var tc:tiposCir = new tiposCir();
		    			tc.cirugias=s;
		    			tiposCir1.addItem(tc);
		    		}
		    	}
		    	
		    }
		    
		    
		    
		    public function renombrarAyu():void
		    {
		    	var texto:String=veterinariosC.selectedLabel;
		    	if(texto!=""){
		    		ayudantes2 = new ArrayCollection();
		    		var i:int;
		    		var j:int = ayudantes3.length;
		    		for(i=0;i<j;i++){
		    			var s:String = ayudantes3.getItemAt(i,0).toString();
		    			if(s!=texto){
		    				ayudantes2.addItem(s);
		    			}
		    		}
		    	}

		    }
		    
		    
		    public function renomCirAdd():void{
		    	tiposCir1.addItem(tabCirs.selectedItem.cirugias);
		    	var n:int=cirugsAdds.getItemIndex(tabCirs.selectedItem.cirugias);
		    	cirugsAdds.removeItemAt(n);
		    	cirugsAdds.refresh();
		    	
		    }
		    
		    public function iniciarPanel():void
		    {
		    	this.costoC.text="";
		    	this.diagC.text="";
		    	this.fechaC.text="";
		    	this.cirugias1.doubleClickEnabled=true;
		    	this.tiposCir2 = new ArrayCollection();
		    	this.tiposCir1 = new ArrayCollection();
		    	this.ayudantes2 = new ArrayCollection();
		    	this.ayudantes3 = new ArrayCollection();
		    	this.veterinarios2 =new ArrayCollection();
		    	this.cirugsAdds =new ArrayCollection();
		    	this.cirugsAdds = new ArrayCollection();

		    }
				
        ]]>
    </mx:Script>
	<mx:Label x="10" y="10" text="Cirugía:" width="110" fontWeight="bold"/>
	<mx:Label x="450.55" y="38" text="Ayudante: " width="78"/>
	<mx:Label x="25.55" y="229" text="Cirugía:" width="63.4" height="17.931034"/>
	<mx:Label x="25.55" y="38" text="Responsable:" width="94.45"/>
	<mx:Label x="450.55" y="66" text="Fecha: " width="78"/>
	<mx:Label x="450.55" y="94" text="Costo:" width="63.4"/>
	<mx:Label x="176" y="399" width="407" height="17" id="labelMessage" textAlign="center" fontWeight="bold"/>
	<mx:Label x="25.55" y="66" text="Diagnostico:" width="77.95"/>
	
	<mx:ComboBox x="119.25" y="36" id="veterinariosC" dataProvider="{veterinarios2}" width="190.25" close="renombrarAyu()"></mx:ComboBox>
	<mx:ComboBox x="536.55" y="36" dataProvider="{ayudantes2}" width="193.7" id="ayudantesC"></mx:ComboBox>
	<mx:TextArea x="119.25" y="65" width="290.7" height="153" id="diagC"/>
	<mx:DateField x="536.55" y="64" width="120.25" id="fechaC"/>
	<mx:TextInput x="536.55" y="92" width="104" id="costoC" restrict="0-9"/>

	<mx:DataGrid x="118.95" y="226" id="cirugias1" width="254" dataProvider="{tiposCir1}" height="116" doubleClick="guardaCir()">
		<mx:columns>
			<mx:DataGridColumn headerText="Cirugías" dataField="cirugias"/>
		</mx:columns>
	</mx:DataGrid>
	
	<mx:Button x="380.95" y="267" label="-&gt;" width="47.55" click="guardaCir()"/>
	<mx:Button x="380.95" y="297" label="&lt;-" width="47.55" click="quitaCir()"/>
	
	<mx:DataGrid x="450.55" y="229" height="116" width="279.7" id="tabCirs" dataProvider="{cirugsAdds}">
		<mx:columns>
			<mx:DataGridColumn headerText="Cirugías a realizar" dataField="cirugias"/>
		</mx:columns>
	</mx:DataGrid>

	<mx:Button x="518.25" y="369" label="Registrar" visible="true" id="registrar" click="registrarCiru()" width="102" height="23"/>
	<mx:Button x="628.25" y="369" label="Cancelar" id="cancelar" visible="true" click="vuelve()" width="102" height="23"/>
	
	
</mx:Panel>
	
	

