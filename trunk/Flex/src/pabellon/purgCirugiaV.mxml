<?xml version="1.0" encoding="utf-8"?>
<mx:Panel xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="779" height="466" borderColor="#15AD8F" title="Anular Cirugía" xmlns:fc="http://www.adobe.com/2006/fc">
	<mx:Script>
		<![CDATA[
		//=======================================================================
		// FECHA CREACIÓN: 14-10-09
		// AUTOR: Esteban Cruz
		// Comentario: Se declara la clase cirugia, una vez instanciada 
		// representa el componente de la capa de interfaz
		//=======================================================================
		
			import mx.controls.List;
			import mx.events.ListEvent; 			
			import mx.controls.Alert;
			import mx.collections.ArrayCollection;
            import mx.controls.CheckBox;    
            import mx.events.CloseEvent;
            import mx.rpc.events.ResultEvent;
            import mx.core.Application;
			
			import transferObjects.CirugiaPurg;
			import services.PurgCirugiaService;
			
			[Bindable]
			private var cirugias:ArrayCollection;
			
			/**
			 * Se hace visible el input correspondiente a la opción
			 * elegida en el combobox
			 */
			private function seleccionarBusqueda (event:Event):void
            {   
            	inputNombreCliente.setVisible(false,false);
				inputApellidoPaterno.setVisible(false,false);
				inputRutCliente.setVisible(false,false);
				inputNombreMascota.setVisible(false,false);
				inputNombreMascota.setVisible(false,false);
				inputRaza.setVisible(false,false);
				inputSexo.setVisible(false,false);
				getAllCirugias();
            	switch (combobox.selectedLabel)
				{
				case 'Nombre cliente':		
					inputNombreCliente.setVisible(true,false);
				break; 
				case 'Apellido paterno':
					inputApellidoPaterno.setVisible(true,false);
				break;
				case 'Rut cliente':
					inputRutCliente.setVisible(true,false);
				break;
				case 'Nombre mascota':
					inputNombreMascota.setVisible(true,false);
				break;
				case 'Raza':
					inputRaza.setVisible(true,false);
				break;
				case 'Sexo':
					inputSexo.setVisible(true,false);
				break;
				}
            }
			
			/**
			 * Evento del boton "Volver", el cual redirige la página
			 * a la estipulada por defecto
			 */
			public function actionVolver():void
			{
				Application.application.setInvisible();
            	Application.application.agenda2.setVisible(true,false);
            	Application.application.menuAgenda1.setVisible(true,false);
			}
			
			/**
			 * Se obtienen todas las cirugías que están registradas en 
			 * la base de datos para ser mostrados dentro del datagrid
			 */
			public function getAllCirugias():void
		    {
		   		var purgCirugiaService:PurgCirugiaService = new PurgCirugiaService();
		   		purgCirugiaService.addEventListener(ResultEvent.RESULT,getAllCirugiasResult);
				purgCirugiaService.getAllCirugias();
		    }
		   
		    /**
			 * Una vez obtenidas todas las cirugías que están registradas 
			 * en la base de datos, son mostrados dentro del datagrid
			 */
		    public function getAllCirugiasResult(event:ResultEvent):void
		    {
		   		cirugias = event.result as ArrayCollection;
		    }
		    
		    /**
			 * Una vez seleccionado un cliente, se procede a visualizar
			 * la siguiente ventana (componente), con los datos 
			 * correspondientes al cliente seleccionado
			 */
		    public function visualizarCirugias(event:Event):void
            {
            	if(tablaCirugias.selectedItem){
            		this.setVisible(false,false);            	 	
            		Application.application.purgCirugia.setDatos(tablaCirugias.selectedItem as CirugiaPurg);
            		Application.application.purgCirugia.setVisible(true,false);
            	}
            }
		
		]]> 
  	</mx:Script>	
  	
  	<!-- Barra estado -->
	<mx:Label x="169" y="390" width="407" height="17" id="barraMsj" textAlign="center" fontWeight="bold"/>
	
	<!-- AutoComplete -->
	<fc:AutoComplete id="inputNombreCliente" x="59" y="10" width="150" dataProvider="{cirugias}" labelField="nombreCliente" visible="false" toolTip="ingrese texto para búsqueda"/>
	<fc:AutoComplete id="inputApellidoPaterno" x="59" y="10" width="150" dataProvider="{cirugias}" labelField="apellidoPaterno" visible="false" toolTip="ingrese texto para búsqueda"/>
	<fc:AutoComplete id="inputRutCliente" x="59" y="10" width="150" dataProvider="{cirugias}" labelField="rutCliente" visible="false" toolTip="ingrese texto para búsqueda"/>
	<fc:AutoComplete id="inputNombreMascota" x="59" y="10" width="150" dataProvider="{cirugias}" labelField="nombreMascota" visible="false" toolTip="ingrese texto para búsqueda"/>
	<fc:AutoComplete id="inputRaza" x="59" y="10" width="150" dataProvider="{cirugias}" labelField="raza" visible="false" toolTip="ingrese texto para búsqueda"/>
	<fc:AutoComplete id="inputSexo" x="59" y="10" width="150" dataProvider="{cirugias}" labelField="sexo" visible="false" toolTip="ingrese texto para búsqueda"/>
	
	<!-- Tabla con datos -->
	<mx:DataGrid x="10" y="64" width="739" height="278" id="tablaCirugias" dataProvider="{cirugias}" doubleClickEnabled="true" itemDoubleClick="visualizarCirugias(event)" >
		<mx:columns>		
			<mx:DataGridColumn headerText="Nombre" dataField="nombreCliente" id="nombreCliente" draggable="false"/>
			<mx:DataGridColumn headerText="Apellido paterno" dataField="apellidoPaterno" id="apellidoPaterno" draggable="false"/>
			<mx:DataGridColumn headerText="Rut" dataField="rutCliente" id="rutCliente" draggable="false"/>
			<mx:DataGridColumn headerText="Nombre" dataField="nombreMascota" id="nombreMascota" draggable="false"/>
			<mx:DataGridColumn headerText="Raza" dataField="raza" id="raza" draggable="false"/>
			<mx:DataGridColumn headerText="Sexo" dataField="sexo" id="sexo" draggable="false"/>
		</mx:columns>
	</mx:DataGrid>
	<mx:Button x="523" y="350" label="Visualizar" id="purgarCirugia" click="{visualizarCirugias(event)}" toolTip="Visualiza el cliente seleccionado" width="102" height="23" cornerRadius="6"/>
	<mx:Button x="647" y="350" label="Volver" id="volver" toolTip="Vuelve al panel principal" width="102" height="23" cornerRadius="6" click="actionVolver()"/>
	<mx:Label x="10" y="12" text="Buscar"/>
	
	<!-- Opciones de busqueda -->
	<mx:ComboBox x="283" y="10" width="150" id="combobox" change="seleccionarBusqueda(event)" toolTip="Seleccione un parámetro de búsqueda">
		<mx:ArrayCollection>
			<mx:Object label="-Seleccione-"/>
			<mx:Object label="Nombre cliente"/>
			<mx:Object label="Apellido paterno"/>
			<mx:Object label="Rut cliente"/> 
			<mx:Object label="Nombre mascota"/> 
			<mx:Object label="Raza"/> 
			<mx:Object label="Sexo"/>
		</mx:ArrayCollection>
	</mx:ComboBox>
	<mx:Text x="217" y="12" id="textFiltrar" text="Filtrar por"/>
	<mx:Text x="10" y="38" text="Cliente&#xd;&#xa;" fontWeight="bold"/>
	<mx:Text x="380" y="38" text="Mascota" fontWeight="bold"/>
</mx:Panel>
